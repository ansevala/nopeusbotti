# nopeusbotti

A Twitter bot that plots the velocities of HSL buses.

# Installation

This project uses Poetry for dependency management. Please refer to their documentation on how to install it: https://python-poetry.org/docs/#installation. The required Python version is >= 3.8.

After installing Poetry, simply run

```bash
poetry install
```

to install all the dependencies in a virtualenv. The map plots generated by folium use Selenium to produce PNG images out of the maps originally rendered in HTML. This may require an additional installation of geckodriver: https://github.com/mozilla/geckodriver/releases. This is an *extremely clumsy* way of doing this, and we should use [contextily](https://contextily.readthedocs.io/en/latest/) or something similar instead.

# Running

After installing the dependencies, the bot can be run with

```
poetry run nopeusbotti [OPTIONS]

Options:
  --north FLOAT        The northernmost latitude coordinate of the monitored
                       area  [required]
  --south FLOAT        The southernmost latitude coordinate of the monitored
                       area  [required]
  --east FLOAT         The easternmost longitude coordinate of the monitored
                       area  [required]
  --west FLOAT         The westernmost longitude coordinate of the monitored
                       area  [required]
  --speed-limit FLOAT  Speed limit withing the monitored area  [required]
  --stop-id TEXT       The stops ids to track. This option can be repeated as
                       many times as needed.  [required]
  --help               Show this message and exit.
```

Additionally, the following Twitter API credentials must be provided as environment variables:
- `ACCESS_TOKEN`
- `ACCESS_TOKEN_SECRET`
- `API_KEY`
- `API_KEY_SECRET`

The "Essential" access category is sufficient to run the bot: API v1.1 is used for posting the images, and v2 for the actual tweets. See https://developer.twitter.com/en/portal/petition/essential/basic-info for more information.

The bot tracks buses heading to specific stops within an area defined by maximum and minimum lat/long values. The stops are defined with their ids, which can be checked from e.g. [Reittiopas](https://reittiopas.hsl.fi). For example the stop Tikkurilan lukio (V6231) has the id `4620231`, as its Reittiopas URL is reittiopas.hsl.fi/pysakit/HSL%3A**4620231**.

The following command

```bash
poetry run nopeusbotti \
  --speed-limit 30 \
  --north 60.297449 --south 60.2958756 --east 25.059465 --west 25.0569888 \
  --stop-id 4620205 --stop-id 4620231 --stop-id 4620222
```

runs the bot as seen on https://twitter.com/30bussit:

- all the buses going to stops V6205, V6222 or V6231 (570 does not stop at V6222, which is why we need two stops at the northern end of the area) are monitored
- the speed limit is 30
- the speed limit is monitored within the depicted area:

![An example of monitored area](/img/area.PNG)